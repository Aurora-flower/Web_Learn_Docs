<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta content="width=device-width, initial-scale=1.0" name="viewport">
		<title>头部导航栏布局</title>
		<link href="css/reset.css" rel="stylesheet">
		<link href="css/index.css" rel="stylesheet">
	</head>

	<body>
		<div class="outer">

			<!-- 侧边栏 -->
			<div class="toolBar">
				<!-- 侧边栏的内容 -->
				<div class="content"></div>
				<!-- 面包屑 -->
				<div class="menu"></div>
				<!-- 中间导航区域 -->
				<ul class="navList">
					<li>
						<i></i>
						<p>商品会员</p>
					</li>
					<li>
						<i></i>
						<p>购物车</p>
					</li>
					<li>
						<i></i>
						<p>我的关注</p>
					</li>
					<li>
						<i></i>
						<p>我的足迹</p>
					</li>
					<li>
						<i></i>
						<p>我的消息</p>
					</li>
					<li>
						<i></i>
						<p>红浪漫来了</p>
					</li>
				</ul>
				<!-- 回到顶部 -->
				<div class="back"></div>
			</div>
			<!-- 头部区域 -->
			<header class="header">
				<div class="headerTop_out">
					<div class="headerTop">
						<div class="headerTop_left">
							<p>尚品汇欢迎您</p>
							<p>
								请
								<a href="javascript:">登录</a>
								<a href="javascript:">免费注册</a>
							</p>
						</div>
						<div class="headerTop_right">
							<a href="javascript:">我的订单</a>
							<a href="javascript:">我的购物车</a>
							<a href="javascript:">我的尚品汇</a>
							<a href="javascript:">尚品汇会员</a>
							<a href="javascript:">企业采购</a>
							<a href="javascript:">关注尚品汇</a>
							<a href="javascript:">合作招聘</a>
							<a href="javascript:">商家后台</a>
						</div>
					</div>

				</div>
				<div class="headerBottom">
					<h1 class="logo">
						<a href="javascript:">
							<img alt="" src="images/Logo.png">
						</a>
					</h1>
					<div class="header_search">
						<label>
							<input type="text">
						</label>
						<button>搜索</button>
					</div>
				</div>
			</header>
			<div class="allnav_outer">
				<div class="allnav">
					<h2>所有商品分类</h2>
					<nav>
						<a href="javascript:">服装城</a>
						<a href="javascript:">美妆馆</a>
						<a href="javascript:">尚品汇超市</a>
						<a href="javascript:">全球购</a>
						<a href="javascript:">闪购</a>
						<a href="javascript:">团购</a>
						<a href="javascript:">有趣</a>
						<a href="javascript:">秒杀</a>
					</nav>
				</div>
			</div>
			<section class="con">
				<div class="conPoint">
					<a href="javascript:">手机、数码、通讯手机</a>
					<a href="javascript:">Apple苹果</a>
					<a>iphone 6S系类</a>
				</div>
				<div class="mainCon">
					<div class="previewArea">
						<div class="preview">
							<!-- 小图区域 -->
							<div class="smallArea">
								<img alt="" src="images/s1.png">
								<!-- 蒙版区域 -->
								<div class="mask"></div>
							</div>
							<!-- 大图区域 -->
							<div class="bigArea">
								<img alt="" src="images/b1.png">
							</div>
						</div>
						<div class="prescroll">
							<p class="left">&lt;</p>
							<div class="listOut">
								<ul class="list">

								</ul>
							</div>
							<p class="right">&gt;</p>
						</div>
					</div>
					<div class="detailArea">
						<div class="priceArea">

						</div>
						<div class="chooseInsert">
						</div>
						<div class="chooseArea">


						</div>
						<div class="goodsNum">
							<div class="num">
								<label>
									<input readonly type="text" value="1">
								</label>
								<button class="plus">+</button>
								<button class="mins">-</button>
							</div>
							<div class="addCart">加入购物车</div>
						</div>
					</div>
				</div>
			</section>

			<!-- 商品详情展示页 -->
		</div>
		<script src="js/data.js"></script>
		<script>

            // 小图区域
            const oSmallArea = document.querySelector('.previewArea .preview .smallArea');
            // 蒙版
            const oMask = document.querySelector('.previewArea .preview .smallArea .mask');

            // 大图区域
            const oBigArea = document.querySelector('.previewArea .preview .bigArea');

            // 大图
            const oBigAreaImg = document.querySelector('.previewArea .preview .bigArea img');
            // Route-base.放大镜
            oPreview();

            function oPreview () {
                oSmallArea.onmousemove = function (event) {
                    event = event || window.event;
                    // 显示蒙版
                    oMask.style.display = 'block';
                    // 蒙版移动
                    // 鼠标坐标赋值给mask的left 和 top
                    // clientX 和 clientY 相对于的是视口
                    // 而蒙版因为定位的原因 相对的是oSmallArea


                    // 获取的是smallArea到视口的距离
                    const smallAreaToWinXY = {
                        x: oSmallArea.getBoundingClientRect().left,
                        y: oSmallArea.getBoundingClientRect().top
                    };

                    // 获取蒙版的宽和高
                    const maskXY = {
                        x: oMask.offsetWidth,
                        y: oMask.offsetHeight
                    };


                    const maskLocationXY = {
                        x: event.clientX - smallAreaToWinXY.x - maskXY.x / 2,
                        y: event.clientY - smallAreaToWinXY.y - maskXY.y / 2
                    };
                    // 左右的边界
                    if (maskLocationXY.x >= oSmallArea.clientWidth - oMask.offsetWidth) {
                        maskLocationXY.x = oSmallArea.clientWidth - oMask.offsetWidth;
                    } else if (maskLocationXY.x <= 0) {
                        maskLocationXY.x = 0;
                    }
                    // 上下边界
                    if (maskLocationXY.y >= oSmallArea.clientHeight - oMask.offsetHeight) {
                        maskLocationXY.y = oSmallArea.clientHeight - oMask.offsetHeight
                    } else if (maskLocationXY.y <= 0) {
                        maskLocationXY.y = 0;
                    }


                    oMask.style.left = maskLocationXY.x + 'px';
                    oMask.style.top = maskLocationXY.y + 'px';


                    // 大图展示
                    oBigArea.style.display = 'block';

                    // 小图联动大图
                    // 蒙版移动的距离 / 蒙版可以移动的距离 = 大图移动的距离 / 大图可以移动的距离

                    // 蒙版移动的距离            大图移动的距离
                    // -------------         =  ------------
                    // 蒙版可以移动的距离         大图可以移动的距离


                    // 大图移动的距离 = 大图可以移动的距离 / 蒙版可以移动的距离 * 蒙版移动的距离


                    const bigAreaCanMoveDis = oBigArea.clientWidth - oBigAreaImg.offsetWidth;
                    const oMaskCanMoveDis = oSmallArea.clientWidth - oMask.offsetWidth;

                    const scale = bigAreaCanMoveDis / oMaskCanMoveDis;

                    const bigAreaLocationXY = {
                        x: maskLocationXY.x * scale,
                        y: maskLocationXY.y * scale,
                    };

                    oBigAreaImg.style.left = bigAreaLocationXY.x + 'px';
                    oBigAreaImg.style.top = bigAreaLocationXY.y + 'px';

                }

                oSmallArea.onmouseleave = function () {
                    oMask.style.display = 'none';
                    oBigArea.style.display = 'none';
                }
            }

            // 2.缩略图
            //   a.动态数据展示
            //   b.点击向右  移动2张图片   移动2个li  到最后停止
            //   c.点击向左
            //   d.移入展示小图
            oThumbnail();

            function oThumbnail () {
                const list = document.querySelector('.previewArea .prescroll .listOut .list');
                // 从js文件来获取图片的数据
                const imgList = goodData.imgsrc;

                imgList.forEach(function (item) {
                    const li = document.createElement('li');
                    // 创建img标签 是可以使用new的方式来创建的
                    const img = new Image();
                    img.src = item.s;
                    // 将img放到li中
                    li.append(img);
                    list.append(li);
                });

                // 向右
                // 每点击一次 移动2个li  一个li是76 那么2个就是152
                // 现在我们一共是15个  当前页面展示的是5个
                // 还有10个要移动
                const right = document.querySelector('.previewArea .prescroll .right');

                const liList = document.querySelectorAll('.previewArea .prescroll .listOut .list li');
                // 每次移动2个li
                const everyMove = liList[0].offsetWidth * 2;

                let location = 0;
                // 能移动的距离
                const allMove = (liList.length - 5) * liList[0].offsetWidth;

                right.onclick = function () {
                    if (location + everyMove <= allMove) {
                        location += everyMove;
                    } else {
                        location = allMove;
                    }
                    console.log(location);
                    list.style.transform = 'translateX(-' + location + 'px)';
                }


                const left = document.querySelector('.previewArea .prescroll .left');

                // 向左
                left.onclick = function () {
                    if (location > everyMove) {
                        location -= everyMove;
                    } else {
                        location = 0;
                    }
                    list.style.transform = 'translateX(-' + location + 'px)';
                }

                // 移入高亮 并且展示小图和大图
                const liImgList = document.querySelectorAll('.previewArea .prescroll .listOut .list li img');

                const smallAreaImg = document.querySelector('.previewArea .preview .smallArea img');

                const bigAreaImg = document.querySelector('.previewArea .preview .bigArea img');

                liImgList.forEach(function (item, index) {
                    item.onmouseenter = function () {
                        smallAreaImg.src = this.src;
                        bigAreaImg.src = imgList[index].b;
                        this.style.border = '1px solid red';
                    }

                    item.onmouseleave = function () {
                        this.style.border = '';
                    }
                })
            }

            // 3.商品详情-上
            oPriceArea();

            function oPriceArea () {

                const priceArea = document.querySelector('.detailArea .priceArea');
                const goodsDetail = goodData.goodsDetail;
                // region
                // endregion
                priceArea.innerHTML = `
                        <h3 class="title">${goodsDetail.title}</h3>
                        <p class="con1">${goodsDetail.recommend}</p>
                        <div class="price">
                            <div class="priceDetail">
                                <p>价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</p>
                                <p>￥ <span>${goodsDetail.price}</span> 元</p>
                            </div>
                            <div class="buy">
                                <p>促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</p>
                                <p><span>${goodsDetail.promoteSales.type}</span>${goodsDetail.promoteSales.content}</p>
                            </div>
                        </div>
                        <div class="support">
                            <div class="supportDetail">
                                <p>支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</p>
                                <p>${goodsDetail.support}</p>
                            </div>
                            <div class="address">
                                <p>配&nbsp;送&nbsp;至</p>
                                <p>${goodsDetail.address}</p>
                            </div>
                        </div>
        `;
            }


            // 4.商品详情-下
            // dl
            //   dt
            //   dd
            oChooseArea();

            function oChooseArea () {
                const chooseArea = document.querySelector('.detailArea .chooseArea');

                const crumbData = goodData.goodsDetail.crumbData;
                // 我们发现crumbData的title其实就是dt中的内容
                // crumbData是一个数组 我们遍历的时候  会将每一个title放到一个dt中
                // 然后dt会存储到dl中 dl会存储到chooseArea中

                crumbData.forEach(function (item) {
                    // 创建一个dt
                    const dt = document.createElement('dt');
                    dt.innerHTML = item.title;

                    // 创建dl
                    const dl = document.createElement('dl');
                    dl.append(dt);

                    item.data.forEach(function (item) {
                        const dd = document.createElement('dd');
                        dd.innerHTML = item.type;
                        // item是{
                        //     type: "黄金色",
                        //     changePrice: 0
                        // }
                        // 将价格绑定在dd身上
                        dd.dataset.changePrice = item.changePrice;
                        dl.append(dd);
                    })

                    chooseArea.append(dl);
                });
            }

            // 5.选择商品类别
            //   高亮
            //   让dl中的dd做一个排他思想
            oChoose();

            function oChoose () {
                const dl_list = document.querySelectorAll('.detailArea .chooseArea dl');
                // 将数组的数据展示
                const chooseInsert = document.querySelector('.detailArea .chooseInsert');
                const arr = new Array(4);
                arr.fill(null);

                dl_list.forEach(function (item, index) {
                    // dl中所有的dd
                    const dd_list = item.querySelectorAll('dd');
                    // 每一个dl中所有的dd
                    dd_list.forEach(function (item) {
                        // 点击dd  利用排他思想  将所有的样式统一 然后将当前点击
                        // 的item的样式 修改为red
                        item.onclick = function () {
                            dd_list.forEach(function (item) {
                                item.style.color = '#666';
                            });
                            this.style.color = 'red';
                            // dl正好有4个  和 数组的下标是一回事
                            // 后面会有个优化的地方。。。。****
                            // 我要将dd这个对象 放到数组中
                            // arr[index] = item.innerHTML;
                            arr[index] = item;

                            // 每一次点击 都要将chooseInsert的内容
                            // 否则会出现数据重复
                            chooseInsert.innerHTML = '';

                            arr.forEach(function (item, index) {
                                // 元素不是null才会展示
                                if (item) {
                                    const mark = document.createElement('mark');
                                    mark.innerHTML = item.innerHTML;

                                    const a = document.createElement('a');
                                    a.innerHTML = 'X';

                                    // 给标签添加一个自定义属性
                                    // 给a的标签中添加了一个属性 名字index
                                    a.dataset.index = `${index}`;
                                    mark.append(a);
                                    chooseInsert.append(mark);
                                }

                            });

                            // 删除
                            // Route-base.删除的是标签
                            // 2.删除数组中的数据
                            // 3.删除数据之后 让第一个选项变红
                            const a_list = document.querySelectorAll('.detailArea .chooseInsert mark a');


                            a_list.forEach(function (item) {
                                item.onclick = function () {
                                    // 删除mark标签
                                    item.parentElement.remove();
                                    // 也要将数组中对应的元素删除
                                    arr[item.dataset.index] = null;
                                    // 找到所有的当前的dl中dd
                                    // 数组的元素 是按照dl中的index来存储的
                                    // 所以数组中的下标就是dl的index
                                    const dd_list = dl_list[item.dataset.index].querySelectorAll('dd');

                                    dd_list.forEach(function (item) {
                                        item.style.color = '#666';
                                    })

                                    dd_list[0].style.color = 'red';

                                    getSinglePrice(arr);

                                }
                            });

                            getSinglePrice(arr);
                        }
                    })
                });


            }


            // 6.计算单价
            // 默认的类别都是0元
            // 单价的计算方式是  基础价格 + 类别的价格（选中类型的价格）
            // 那么选中的数据都是存储在数组中的

            // 我想获取的数选中数据的价格 但是数组中只有内容 没有价格
            // getSinglePrice();

            function getSinglePrice (arr) {
                let basePrice = goodData.goodsDetail.price;
                const singPrice = document.querySelector('.detailArea .price .priceDetail p:nth-child(2) span');

                const inp = document.querySelector('.detailArea .goodsNum .num input');

                const num = inp.value;
                arr.forEach(function (item) {
                    if (item) {
                        basePrice += +item.dataset.changePrice;
                    }
                });

                singPrice.innerHTML = `${basePrice * num}`;
            }


            // 7.数量的变化
            changeNum();

            function changeNum () {
                const inp = document.querySelector('.detailArea .goodsNum .num input');

                const plus = document.querySelector('.detailArea .goodsNum .num .plus');

                const mins = document.querySelector('.detailArea .goodsNum .num .mins');
                let inp_value = inp.value;
                const singPrice = document.querySelector('.detailArea .price .priceDetail p:nth-child(2) span');

                // 加
                plus.onclick = function () {
                    inp_value++;
                    inp.value = inp_value;
                    singPrice.innerHTML = `${singPrice.innerHTML / (inp_value - 1) * inp.value}`;


                }
                // 减
                mins.onclick = function () {
                    if (inp_value > 1) {
                        inp_value--;
                    } else {
                        return;
                    }
                    inp.value = inp_value;

                    singPrice.innerHTML =`${singPrice.innerHTML / (inp_value + 1) * inp.value}`;


                }
            }
		</script>
	</body>

</html>